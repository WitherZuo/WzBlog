---
title: 陈·年·旧·案
tags: 随笔
categories: 随笔
titlename: chen-nian-jiu-an
date: 2021-01-12 16:57:05
updated: 2021-01-12 21:47:03
---

最近心血来潮，想着好长时间没有通过 SSH 连接到自己的笔记本了，决定再通过 SSH 连一次过把瘾，谁知道竟然连不上了……而我之前配置 SSH 的时候，服务端（也就是笔记本电脑这一端），选择的验证方式是密码登录验证，也就是说公私钥的问题在我电脑上是不存在的，结果为了解决这个问题，我尝试了各种各样的方法，最后虽然问题解决了，但是造成这个问题的原因却令我哭笑不得🤣……<!-- more -->  

## SSH  

一开始我先想到的是 OpenSSH 这个组件本身，毕竟当初是通过 Windows 10 设置面板自带的“可选功能”这个面板里安装的，而 Windows 10 的尿性大家都懂（hhh），所以一开始我认为是这个组件本身出了问题，于是进入到“可选功能”面板，直接找到 OpenSSH 的客户端和服务端两个组件，直接卸载了再重装，就是这样的：  

[![可选功能](https://s3.ax1x.com/2021/01/12/sYg0OI.png "可选功能")](https://imgchr.com/i/sYg0OI)  

卸载了之后重新启动，然后再进去重新安装这两个组件，然后再用 Termux 通过 SSH 登录到电脑（我是用手机登录到电脑的），结果……输入了三次密码，还是报 Permission Denied（权限不足），失败了……😂  

然后我又想起来，会不会是因为**对应的系统服务没有打开没有运行**的缘故？因为之前有过好几次 sshdbroker 这个 SSH 代理服务在重新启动系统后无法自动启动的情况，于是我又把焦点瞄准到这几个相关的服务上，打开服务管理器，找找看：  

[![三服务之一](https://s3.ax1x.com/2021/01/12/sYgWlj.png "三服务之一")](https://imgchr.com/i/sYgWlj)  

[![三服务之一](https://s3.ax1x.com/2021/01/12/sYgRpQ.png "三服务之一")](https://imgchr.com/i/sYgRpQ)  

[![三服务之一](https://s3.ax1x.com/2021/01/12/sYggfg.png "三服务之一")](https://imgchr.com/i/sYggfg)  

啊这……都没问题，而且我又分别进入到这些系统服务的属性面板中看过，**启动类型都设置为了“自动（延迟启动）”**，**服务启动失败后的行为操作我都设置为了“重新启动服务”**，没道理这里会出问题啊，所以相关组件的服务异常的问题也被排除了……  

再之后我认为有可能是配置文件本身的问题，于是我找到存放 OpenSSH 设置的目录，直接进去删掉原有的设置文件，然后又拷贝了一份默认缺省的设置文件进去，然后一通改配置，又是**设置仅密码登录**、又是**设置为允许特权用户登录**、又是**设置允许空密码登录**等等……当然，也都**无一例外没有任何作用**🤣  

经历了 N 多次失败后，灰头土脸的我猛然想起来，<span style="background:red;color:white">之前通过 SSH 登录到电脑的时候，因为**嫌弃默认登录到的命令行终端是 CMD 命令提示符，所以就自己找教程，按照里面的方法把 CMD 改成了 PowerShell，又因为觉得系统自带的老 PowerShell 5.1 没什么用，再加上当时已经用了一段时间的新的 PowerShell Core 7，当时就把通过 SSH 登录后显示的命令行终端改成了 PowerShell Core 7（用注册表的方式改的），后来因为出了点问题，就把之前安装的 Win32 版的 PowerShell Core 换成了应用商店的版本，Win32 版的就给删掉了**（当时大概是去年 11 月份左右删的）</span>，不会是跟这个有关系吧……？  

于是我立刻到网上搜索找那个改默认终端的教程，幸运的是经过一番搜索找到了，而且还是[微软官方文档的教程](https://docs.microsoft.com/zh-cn/windows-server/administration/openssh/openssh_server_configuration)（后来我才回忆起来，当初我就是照着这个文档改的，结果之后忘了这茬了 2333）  

[![微软官方文档](https://s3.ax1x.com/2021/01/12/sY2KN8.jpg "微软官方文档")](https://imgchr.com/i/sY2KN8)

```powershell
New-ItemProperty -Path "HKLM:\SOFTWARE\OpenSSH" -Name DefaultShell -Value "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" -PropertyType String -Force
```

于是我又去注册表编辑器里，循着这个路径找过去，好家伙，这个路径居然还真是我之前改的那个已经被删掉了的 Win32 版的 PowerShell Core 的路径，然而这个**路径已经无效**了，怎么可能从这个地方启动终端呢？对了，很有可能就是因为这个的缘故，我参照微软的文档又改了回去，再用`ssh thinkpad@192.168.0.106`一登录，输入密码确认后，奇迹出现了，居然真的出现了久违的命令行终端，没有再出现什么 Permission Denid 之类的报错了，问题解决了 :P  

## FTP  

解决了 SSH 的连接问题，还有一个 FTP 的文件显示问题没有解决，给电脑开 FTP 服务器的本意是为了能够在处于同一局域网的环境下，能够随时提取电脑上的文件，可是后来，不知道调了 Wing FTP Server 里的什么设置，总之就是有一部分文件和文件夹莫名其妙的“消失”了。说消失不是真的消失了，而是**电脑上本地位置明明真实存在这些文件和文件夹，但是通过 FTP 连上后，愣是找不到它们**（**我没有给这些文件/文件夹设置隐藏属性**）诡异的很，而且也找不到原因，无论是重新启动 FTP 服务器和控制面板，修改一遍自认为有可能相关联的设置项，还是重新安装一遍 Wing FTP Server，都没能解决这个问题……（是不是和上面经历的事情差不多 hhh）🤣  

更加诡异的是，**这个情况只出现在系统盘上**，对应到我的笔记本上也就是 C 盘，其它的，D、E、F 三个盘没有出现这个情况……就差重装系统了（  

直到后来，翻遍了整个设置面板后，我发现一个**最不可能造成这个问题的设置，却恰恰是造成这个问题的“罪魁祸首”**：  

[![显示隐藏的文件或目录](https://s3.ax1x.com/2021/01/12/sY2rv9.png "显示隐藏的文件或目录")](https://imgchr.com/i/sY2rv9)

对，就是这个“**显示隐藏的文件或目录**”的选项框！在“域”管理目录下的“用户”一栏中……    

明明是“**显示隐藏的文件或目录**”，结果，勾上这个选项框，就无法显示这些文件和文件夹；相反的，如果反选这个选项框，就能够正常显示出这些文件和文件夹。这整个就是一个“**反向操作**”嘛……  

后来回想了一下，这可能是我当时**出于某种未知的好奇心**（？）勾上的选项，**然后自己又忘了**的又一起典型事例吧……虽然我并不知道这个选项本身到底是出了什么问题……  

{% note danger %}
<span style="background:red;color:white">**所以说，没事不要乱改默认或者缺省的设置项，如果确实改了这些设置项而你的记性又不太好的话，那就找个地方把它们记下来，否则管住手千万别手贱，到时候各种疑难问题一同爆发只会让你开始各种怀疑人生**</span>🤣  
{% endnote %}  

## 一点副产品  

在配置好 PC 的 SSH 登录后，我又开始打起了电脑通过 SSH 登录到手机的想法，但是我查了一部分教程，都只有通过生成公私钥进行免密码登录的方法，而且还说 Termux 只支持这种方法。而我找到了 [Termux 的官方 Wiki](https://wiki.termux.com/wiki/Remote_Access)，它是这么说的：（参阅“Using the SSH server”这一部分）  

[![Termux Wiki](https://s3.ax1x.com/2021/01/12/sY2cHx.jpg "Termux Wiki")](https://imgchr.com/i/sY2cHx)

这明明就可以嘛，官方都有说过支持的，**唯一需要注意的是 Termux 出于安全原因，默认的登录端口是 8022 而非 22，因此如果想要通过 SSH 登录到 Termux，那么命令需要这样：`ssh user_name@device_ip_address -p 8022`，其中`-p 8022`是指定端口为 8022**。